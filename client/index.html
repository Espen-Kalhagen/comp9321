
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <!--<link rel="icon" href="/docs/4.0/assets/img/favicons/favicon.ico">-->

    <title>Predict-a-thon</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.0/examples/checkout/">

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <!--Vue package-->
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
    
  </head>

  <body class="bg-light">

    <div class="container">
      <div class="py-5 text-center">
        <img class="d-block mx-auto mb-4" src="https://dynamic.brandcrowd.com/asset/logo/c9d7a8a0-6160-4162-8278-9be5f1fb757b/logo?v=4&text=Predict-a-thon" alt="Predict-a-thon logo" width="250">
        <h2>Predict-a-thon</h2>
        <p class="lead">This one amazing predictor has critics and video games producers trembling, by predicting the score of video games or their sales both critics and producers are out of a job!</p>
      </div>
      <div id="app">

      <div class="row">
        <div class="col-md-12">
          <div class="alert alert-danger" role="alert" v-if="errors.length">
          <p >
              <b>Please correct the following error(s):</b>
              <ul>
                <li v-for="error in errors">{{ error }}</li>
              </ul>
            </p>
          </div>
        </div>

          <div class="col-md-6 order-md-2 mb-6">
            <h3>Predict rating</h3>
              <div class="form-group">
                <label for="exampleFormControlInput1">Number of sales in millions</label>
                <input v-model="sales" type="number" class="form-control" id="exampleFormControlInput1" placeholder="0-40">
              </div>
              <div class="form-group">
                  <label for="exampleFormControlInput2">Year released</label>
                  <input v-model="year1" type="number" class="form-control" id="exampleFormControlInput2"  placeholder="1994-2019">
              </div>
              <div class="form-group">
                <label for="exampleFormControlSelect1">Select region</label>
                <select v-model="region1" class="form-control" id="exampleFormControlSelect1">
                  <option>NA</option>
                  <option>EU</option>
                  <option>JP</option>
                  <option>Others</option>

                </select>
              </div>
            <button class="btn btn-primary" v-on:click="clickPredictRating">Predict rating</button>
            
          </div>
          <div class="col-md-6 order-md-2 mb-6">
              <h3>predict sales</h3>
                <div class="form-group">
                  <label for="exampleFormControlInput1">Rating so far</label>
                  <input v-model="rating" type="number" class="form-control" id="exampleFormControlInput1"  placeholder="0-100">
                </div>
                <div class="form-group">
                  <label for="exampleFormControlInput2">Year released</label>
                  <input v-model="year2" type="number" class="form-control" id="exampleFormControlInput2"  placeholder="1994-2019">
                </div>
                <div class="form-group">
                  <label for="exampleFormControlSelect1">Select region</label>
                  <select v-model="region2" class="form-control" id="exampleFormControlSelect1">
                  <option>NA</option>
                  <option>EU</option>
                  <option>JP</option>
                  <option>Others</option>
                  </select>
                </div>
                
              <button class="btn btn-primary" v-on:click="clickPredictSales">Predict sales</button>
            </div>
          
      </div>
      <br>
      <div class="row">
        <div class="col-md-12">
          <h3>Group by query</h3>
          <p>Queries the dataset with a group by to be able to gain insights in the data</p>

          <div class="form-group">
              <label for="exampleFormControlSelect1">Select group by category</label>
              <select v-model="groupby_category" class="form-control" id="exampleFormControlSelect1">
              <option>year</option>
              <option>publisher</option>
              <option>genre</option>
              <option>platform</option>
              <option>developer</option>
              </select>
          </div>

          <div class="form-group">
              <label for="exampleFormControlSelect1">Select aggregation function</label>
              <select v-model="groupby_sum" class="form-control" id="exampleFormControlSelect1">
              <option>sum</option>
              <option>avarage</option>
              </select>
          </div>

          <button class="btn btn-primary" v-on:click="clickCalculateGroupBy">Calculate group by</button>

        </div>
      </div>
      
      <footer class="my-5 pt-5 text-muted text-center text-small">
        <p class="mb-1"> 2019 Group + 2 COMP9321</p>
        <ul class="list-inline">
          <li class="list-inline-item"><a href="https://github.com/Espen-Kalhagen/comp9321">Github</a></li>
        </ul>
      </footer>
    </div>
    </div>

    <!-- Bootstrap core JavaScript-->

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- alert package-->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>

    <script>
      // let apiURL = "https://6d61d194-0851-49f9-b050-6e71675fa040.mock.pstmn.io"
      let apiURL = "http://127.0.0.1:5000"

      var app = new Vue({
      el: '#app',
      data: {
          sales:undefined,
          region1:"NA",
          year1:undefined,
          rating:undefined,
          region2:"NA",
          year2:undefined,
          errors:[],
          groupby_category:"publisher",
          groupby_sum:"sum",
          groupby_data:undefined
      },
      methods: {
        handleRequest: function(response){
          result = response.data;
          
          //Request not successfull
          if(response.status > 250){
            Swal.fire({
              title: '<strong>Unable to predict</strong>',
              icon: 'error',
              html:
                'Predict-a-thon failed with error '+response.statusText,
              showCloseButton: true});
          }

          console.log(response);

          //A rating received
          if(result.rating != null){
            Swal.fire({
              title: '<strong>'+result.rating+'</strong>',
              icon: 'success',
              html:
                'Predict-a-thons predicted a user rating',
              showCloseButton: true});
          }
          //A sales number recived
          else if(result.sales != null){
            Swal.fire({
              title: '<strong>'+result.sales+'</strong>',
              icon: 'success',
              html:
                'Predict-a-thons predicted sales number in ' + this.region2,
              showCloseButton: true});
          }
        },
        handleLoggin: function(response){

          if (response.status == 201 || response.status == 409) {
                    axios.post(apiURL + '/security/login', user).then(function (response) {
                        if (response.status == 200) {
                          axios.defaults.headers.post['Authorization'] = "Bearer " + response.data.Authorization
                          axios.post(apiURL + '/security/keys', user).then(function (response) {
                              if (response.status == 201) {
                                  axios.defaults.headers.common['x-api-key'] = response.data.key
                              }
                          })
                        }
                    })
                  }
            else{
              console.log(response)
            }

        },
        handleError: function(error){
          Swal.fire({
              title: '<strong>Unable to predict</strong>',
              icon: 'error',
              html:
                'Predict-a-thon failed with error: '+error.message,
              showCloseButton: true});
        },
        clickPredictSales: function () {
          this.errors = [];
          //Error handeling
          if (this.rating == null|| this.sales == "") {
            this.errors.push('Rating required');
          }
          if (parseInt(this.rating) < 0 || parseInt(this.rating) > 100 ) {
            this.errors.push('Rating required to be between 0 and 100');
          }


          if(this.errors.length < 1){
            axios
              .get(apiURL+"/predict/sales?year="+this.year2+"&region="+this.region2+"&rating="+this.rating, {withCredentials: true})
              .then(response => this.handleRequest(response))
              .catch(error => this.handleError(error));

          }


        },
        clickPredictRating: function () {

          this.errors = [];
          //Error handeling
          if (this.sales == null || this.sales == "") {
            this.errors.push('Sales required');
          }
          if (parseInt(this.sales) < 0 || parseInt(this.sales) > 40) {
            this.errors.push('Sales required to be positive');
          }


          if(this.errors.length < 1){
            axios
              .get(apiURL+"/predict/rating?year="+this.year1+"&region="+this.region1+"&sales="+this.sales, {withCredentials: true})
              .then(response => this.handleRequest(response))
              .catch(error => this.handleError(error));
          }
          
          
        },
        clickCalculateGroupBy: function(){
          sum = this.groupby_sum==="sum"
          axios
              .get(apiURL+"/statistics/groupby?category="+this.groupby_category+"&sum="+sum, {withCredentials: true})
              .then(response => {
                console.log(response)
                Swal.fire({
                  title: '<strong>Groupby result</strong>',
                  icon: 'success',
                  html:
                    '<div>'+
                      '<pre id="json">' +JSON.stringify(response.data, undefined, 2)+'</pre>'+
                    '</div>',
                  showCloseButton: true
                });
                
              })
              .catch(error => this.handleError(error));
        }
        
      },
      mounted() {

          user = {
              "username": "testclient",
              "password": "superSecret"
          };
          axios.post(apiURL + '/security/users', user)
              .then(response => this.handleLoggin(response)).catch(error => this.handleLoggin(error.response));
      }
      })
    </script>
  </body>
</html>
